(function(){var Coalmine,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};Coalmine=function(){var Configuration;Coalmine.prototype.URL_BASE=":scheme://:host/events?signature=:signature&json=:json";Coalmine.prototype.MSIE_MAX_URL_LENGTH=2048;Coalmine.prototype.TRUNCATED_SEQ="(...)";Configuration=function(){function Configuration(){this.scheme="https";this.host="coalmineapp.com";this.enabledEnvironments=["production","staging"];this.signature=null;this.version=null;this.environment=null;this.parameters=null;this.ipAddress=null;this.method=null;this.userId=null;this.customVariables={}}return Configuration}();function Coalmine(){this.config=new Configuration;this.errors=[];this.crit=this.critical;this.err=this.error;this.warn=this.warning}Coalmine.prototype.configure=function(callback){return callback(this.config)};Coalmine.prototype.critical=function(message,additionalData){additionalData.severity="critical";return this.notify(message,additionalData)};Coalmine.prototype.error=function(message,additionalData){additionalData.severity="error";return this.notify(message,additionalData)};Coalmine.prototype.warning=function(message,additionalData){additionalData.severity="warning";return this.notify(message,additionalData)};Coalmine.prototype.info=function(message,additionalData){additionalData.severity="info";return this.notify(message,additionalData)};Coalmine.prototype.debug=function(message,additionalData){additionalData.severity="debug";return this.notify(message,additionalData)};Coalmine.prototype.setCustomVariable=function(key,value){return this.config.customVariables[key]=value};Coalmine.prototype.notify=function(message,additionalData){var e,error,html,script,sendable,src,_ref;e=null;if(typeof message==="object"){e=message;message=e.message}error=this.createNotification(message,additionalData);this.errors.push(error);sendable=(_ref=this.config.environment,__indexOf.call(this.config.enabledEnvironments,_ref)>=0);if(sendable){src=this.createSafeUrl(error);if(!src){return}script=document.createElement("script");script.src=src;html=document.documentElement;if(document.body){document.body.appendChild(script)}return true}else{return error}};Coalmine.prototype.createSafeUrl=function(error){var excess,i,isMsie,longParameter,longParameters,newLength,parameter,totalLength,url,_i,_j,_len,_len1;url=this.createUrl(error);isMsie=error.user_agent.indexOf("MSIE")>-1;if(!(error.user_agent!=null&&isMsie)){return url}excess=url.length-this.MSIE_MAX_URL_LENGTH;if(excess<=0){return url}longParameters=[{name:"user_agent",weight:0},{name:"stack_trace",weight:0},{name:"parameters",weight:0},{name:"cookies",weight:0},{name:"referrer",weight:0}];excess=url.length-this.MSIE_MAX_URL_LENGTH;totalLength=0;for(i=_i=0,_len=longParameters.length;_i<_len;i=++_i){longParameter=longParameters[i];parameter=error[longParameter.name];if(parameter==null){continue}longParameter.weight=parameter.length/excess*(i+1);totalLength+=parameter.length}if(totalLength>=excess){longParameters.sort(function(a,b){return b.weight-a.weight});for(_j=0,_len1=longParameters.length;_j<_len1;_j++){longParameter=longParameters[_j];excess=url.length-this.MSIE_MAX_URL_LENGTH;if(excess<=0){return url}if(longParameter.weight<=0){continue}parameter=error[longParameter.name];newLength=parameter.length-excess-this.TRUNCATED_SEQ.length;if(newLength<0){newLength=0}error[longParameter.name]=parameter.substring(0,newLength)+this.TRUNCATED_SEQ;url=this.createUrl(error)}}return url};Coalmine.prototype.createUrl=function(error){var url;url=this.URL_BASE;url=url.replace(":scheme",this.config.scheme);url=url.replace(":host",this.config.host);url=url.replace(":signature",this.config.signature);url=url.replace(":json",encodeURIComponent(JSON.stringify(error)));return url};Coalmine.prototype.createNotification=function(message,additionalData){var key,line,notification,severity,url,version;if(typeof additionalData!=="object"){additionalData={}}url=line=severity="";if("url"in additionalData){url=""+additionalData.url}if("line"in additionalData){line=""+additionalData.line}if("severity"in additionalData){severity=""+additionalData.severity}version=this.config.version;if(!version){version=""+version}notification={version:version,app_environment:this.config.environment,user_id:""+this.config.userId,application:this.config.customVariables,url:this.getRequestUrl(url),method:this.config.method,parameters:this.config.parameters||this.getParameters(url),ip_address:this.config.ipAddress,hostname:window.location.hostname||"",user_agent:navigator.userAgent||"",referrer:document.referrer||"",cookies:document.cookie||"",severity:severity||"error",stack_trace:this.getStackTrace(arguments),message:message||"",line_number:line||""};for(key in notification){if(!notification.key){delete notification.key}}return notification};Coalmine.prototype.getRequestUrl=function(url){if(url!=null&&typeof url==="string"){return url}else{return window.location.href}};Coalmine.prototype.getParameters=function(url){var anchor,parameters;url=this.getRequestUrl(url);parameters="";if(url){if(url.indexOf("?")!==-1){parameters=url.replace(/.*\?/,"").replace(/#.*/,"").replace(/&$/,"")}if(url.indexOf("#")!==-1){anchor=url.replace(/.*#/,"");if(/(?:.+=[^\&]*)+/.test(anchor)){anchor=anchor.replace(/&$/,"");if(parameters){parameters+="&"}parameters+=anchor}}}return parameters};Coalmine.prototype.getStackTrace=function(message,url,line){var stackTrace;stackTrace="";if(typeof message==="object"){stackTrace=printStackTrace({e:message})}else{stackTrace=printStackTrace()}return stackTrace.join("\n")};Coalmine.prototype.getErrors=function(){return this.errors};Coalmine.prototype.hasMessage=function(string){var error,_i,_len,_ref;_ref=this.errors;for(_i=0,_len=_ref.length;_i<_len;_i++){error=_ref[_i];if(error.message.indexOf(string)!==-1){return true}}return false};return Coalmine}();window.coalmine=new Coalmine;if(typeof JSON!=="object"){JSON={}}(function(){"use strict";function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else if(typeof space==="string"){indent=space}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})();function printStackTrace(options){options=options||{guess:true};var ex=options.e||null,guess=!!options.guess;var p=new printStackTrace.implementation,result=p.run(ex);return guess?p.guessAnonymousFunctions(result):result}printStackTrace.implementation=function(){};printStackTrace.implementation.prototype={run:function(ex,mode){ex=ex||this.createException();mode=mode||this.mode(ex);if(mode==="other"){return this.other(arguments.callee)}else{return this[mode](ex)}},createException:function(){try{this.undef()}catch(e){return e}},mode:function(e){if(e["arguments"]&&e.stack){return"chrome"}else if(typeof e.message==="string"&&typeof window!=="undefined"&&window.opera){if(!e.stacktrace){return"opera9"}if(e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length){return"opera9"}if(!e.stack){return"opera10a"}if(e.stacktrace.indexOf("called from line")<0){return"opera10b"}return"opera11"}else if(e.stack){return"firefox"}return"other"},instrumentFunction:function(context,functionName,callback){context=context||window;var original=context[functionName];context[functionName]=function instrumented(){callback.call(this,printStackTrace().slice(4));return context[functionName]._instrumented.apply(this,arguments)};context[functionName]._instrumented=original},deinstrumentFunction:function(context,functionName){if(context[functionName].constructor===Function&&context[functionName]._instrumented&&context[functionName]._instrumented.constructor===Function){context[functionName]=context[functionName]._instrumented}},chrome:function(e){var stack=(e.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");stack.pop();return stack},firefox:function(e){return e.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera11:function(e){var ANON="{anonymous}",lineRE=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/;var lines=e.stacktrace.split("\n"),result=[];for(var i=0,len=lines.length;i<len;i+=2){var match=lineRE.exec(lines[i]);if(match){var location=match[4]+":"+match[1]+":"+match[2];var fnName=match[3]||"global code";fnName=fnName.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,ANON);result.push(fnName+"@"+location+" -- "+lines[i+1].replace(/^\s+/,""))}}return result},opera10b:function(e){var ANON="{anonymous}",lineRE=/^(.*)@(.+):(\d+)$/;var lines=e.stacktrace.split("\n"),result=[];for(var i=0,len=lines.length;i<len;i++){var match=lineRE.exec(lines[i]);if(match){var fnName=match[1]?match[1]+"()":"global code";result.push(fnName+"@"+match[2]+":"+match[3])}}return result},opera10a:function(e){var ANON="{anonymous}",lineRE=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;var lines=e.stacktrace.split("\n"),result=[];for(var i=0,len=lines.length;i<len;i+=2){var match=lineRE.exec(lines[i]);if(match){var fnName=match[3]||ANON;result.push(fnName+"()@"+match[2]+":"+match[1]+" -- "+lines[i+1].replace(/^\s+/,""))}}return result},opera9:function(e){var ANON="{anonymous}",lineRE=/Line (\d+).*script (?:in )?(\S+)/i;var lines=e.message.split("\n"),result=[];for(var i=2,len=lines.length;i<len;i+=2){var match=lineRE.exec(lines[i]);if(match){result.push(ANON+"()@"+match[2]+":"+match[1]+" -- "+lines[i+1].replace(/^\s+/,""))}}return result},other:function(curr){var ANON="{anonymous}",fnRE=/function\s*([\w\-$]+)?\s*\(/i,stack=[],fn,args,maxStackSize=10;while(curr&&curr["arguments"]&&stack.length<maxStackSize){fn=fnRE.test(curr.toString())?RegExp.$1||ANON:ANON;args=Array.prototype.slice.call(curr["arguments"]||[]);stack[stack.length]=fn+"("+this.stringifyArguments(args)+")";curr=curr.caller}return stack},stringifyArguments:function(args){var result=[];var slice=Array.prototype.slice;for(var i=0;i<args.length;++i){var arg=args[i];if(arg===undefined){result[i]="undefined"}else if(arg===null){result[i]="null"}else if(arg.constructor){if(arg.constructor===Array){if(arg.length<3){result[i]="["+this.stringifyArguments(arg)+"]"}else{result[i]="["+this.stringifyArguments(slice.call(arg,0,1))+"..."+this.stringifyArguments(slice.call(arg,-1))+"]"}}else if(arg.constructor===Object){result[i]="#object"}else if(arg.constructor===Function){result[i]="#function"}else if(arg.constructor===String){result[i]='"'+arg+'"'}else if(arg.constructor===Number){result[i]=arg}}}return result.join(",")},sourceCache:{},ajax:function(url){var req=this.createXMLHTTPObject();if(req){try{req.open("GET",url,false);req.send(null);return req.responseText}catch(e){}}return""},createXMLHTTPObject:function(){var xmlhttp,XMLHttpFactories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var i=0;i<XMLHttpFactories.length;i++){try{xmlhttp=XMLHttpFactories[i]();this.createXMLHTTPObject=XMLHttpFactories[i];return xmlhttp}catch(e){}}},isSameDomain:function(url){return url.indexOf(location.hostname)!==-1},getSource:function(url){if(!(url in this.sourceCache)){this.sourceCache[url]=this.ajax(url).split("\n")}return this.sourceCache[url]},guessAnonymousFunctions:function(stack){for(var i=0;i<stack.length;++i){var reStack=/\{anonymous\}\(.*\)@(.*)/,reRef=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,frame=stack[i],ref=reStack.exec(frame);if(ref){var m=reRef.exec(ref[1]);if(m){var file=m[1],lineno=m[2],charno=m[3]||0;if(file&&this.isSameDomain(file)&&lineno){var functionName=this.guessAnonymousFunction(file,lineno,charno);stack[i]=frame.replace("{anonymous}",functionName)}}}}return stack},guessAnonymousFunction:function(url,lineNo,charNo){var ret;try{ret=this.findFunctionName(this.getSource(url),lineNo)}catch(e){ret="getSource failed with url: "+url+", exception: "+e.toString()}return ret},findFunctionName:function(source,lineNo){var reFunctionDeclaration=/function\s+([^(]*?)\s*\(([^)]*)\)/;var reFunctionExpression=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/;var reFunctionEvaluation=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/;var code="",line,maxLines=Math.min(lineNo,20),m,commentPos;for(var i=0;i<maxLines;++i){line=source[lineNo-i-1];commentPos=line.indexOf("//");if(commentPos>=0){line=line.substr(0,commentPos)}if(line){code=line+code;m=reFunctionExpression.exec(code);if(m&&m[1]){return m[1]}m=reFunctionDeclaration.exec(code);if(m&&m[1]){return m[1]}m=reFunctionEvaluation.exec(code);if(m&&m[1]){return m[1]}}}return"(?)"}};window.onerror=function(message,url,line){return coalmine.error(message,{url:url,line:line})}}).call(this);
/*
//@ sourceMappingURL=coalmine.min.map
*/